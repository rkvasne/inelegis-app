const leiSelect=document.getElementById('leiSelect');const artigoInput=document.getElementById('artigoInput');const buscarBtn=document.getElementById('searchBtn');const resultadoDiv=document.getElementById('resultado');const sugestoesDiv=document.getElementById('suggestions');const radioCondenacao=document.getElementById('condenacao');const radioExtincao=document.getElementById('extincao');const dataOcorrenciaCondenacao=document.getElementById('dataOcorrenciaCondenacao');const dataOcorrenciaExtincao=document.getElementById('dataOcorrenciaExtincao');document.addEventListener('DOMContentLoaded',function(){if(!leiSelect||!artigoInput||!buscarBtn){return;}popularSelectLeis();configurarEventListeners();configurarRadioButtons();leiSelect.focus();if(leiSelect.options.length>1){leiSelect.selectedIndex=1;leiSelect.dispatchEvent(new Event('change'));}});function configurarRadioButtons(){radioCondenacao.addEventListener('change',function(){if(this.checked){dataOcorrenciaCondenacao.style.display='block';dataOcorrenciaExtincao.style.display='none';}});radioExtincao.addEventListener('change',function(){if(this.checked){dataOcorrenciaCondenacao.style.display='none';dataOcorrenciaExtincao.style.display='block';}});}function obterTipoComunicacao(){return radioCondenacao.checked ? 'condenacao' : 'extincao';}function popularSelectLeis(){leiSelect.innerHTML='<option value="">Selecione uma lei...</option>';leisDisponiveis.forEach(lei=>{const option=document.createElement('option');option.value=lei.value;option.textContent=lei.text;leiSelect.appendChild(option);});}function configurarEventListeners(){const debouncedSugestoes=(function(){let t;return function(v){clearTimeout(t);t=setTimeout(()=>{if(v&&v.length>0){mostrarSugestoes(v);}else{esconderSugestoes();}},220);};})();leiSelect.addEventListener('change',function(){if(this.value){artigoInput.disabled=false;document.getElementById('artigoNum').disabled=false;document.getElementById('paragrafoNum').disabled=false;document.getElementById('incisoNum').disabled=false;document.getElementById('alineaNum').disabled=false;document.getElementById('concomitanteNum').disabled=false;document.getElementById('insertParagrafoBtn').disabled=false;document.getElementById('insertAlineaBtn').disabled=false;document.getElementById('insertConcBtn').disabled=false;document.getElementById('montarArtigoBtn').disabled=false;artigoInput.focus();}else{artigoInput.disabled=true;artigoInput.value='';buscarBtn.disabled=true;document.getElementById('artigoNum').disabled=true;document.getElementById('paragrafoNum').disabled=true;document.getElementById('incisoNum').disabled=true;document.getElementById('alineaNum').disabled=true;document.getElementById('concomitanteNum').disabled=true;document.getElementById('insertParagrafoBtn').disabled=true;document.getElementById('insertAlineaBtn').disabled=true;document.getElementById('insertConcBtn').disabled=true;document.getElementById('montarArtigoBtn').disabled=true;limparBusca();}verificarCamposPreenchidos();});document.getElementById('insertParagrafoBtn').addEventListener('click',function(e){e.preventDefault();const paraNum=document.getElementById('paragrafoNum').value;if(paraNum){artigoInput.value+=`,¬ß${paraNum}¬∫`;artigoInput.focus();verificarCamposPreenchidos();debouncedSugestoes(artigoInput.value.trim());}});document.getElementById('insertAlineaBtn').addEventListener('click',function(e){e.preventDefault();const alinea=document.getElementById('alineaNum').value;if(alinea){artigoInput.value+=`,"${alinea}"`;artigoInput.focus();verificarCamposPreenchidos();debouncedSugestoes(artigoInput.value.trim());}});document.getElementById('insertConcBtn').addEventListener('click',function(e){e.preventDefault();const conc=document.getElementById('concomitanteNum').value;if(conc){artigoInput.value+=` c/c ${conc}`;artigoInput.focus();verificarCamposPreenchidos();debouncedSugestoes(artigoInput.value.trim());}});document.getElementById('montarArtigoBtn').addEventListener('click',function(e){e.preventDefault();const artigo=document.getElementById('artigoNum').value;const paragrafo=document.getElementById('paragrafoNum').value;const inciso=document.getElementById('incisoNum').value;const alinea=document.getElementById('alineaNum').value;const concomitante=document.getElementById('concomitanteNum').value;if(!artigo){alert('Digite o n√∫mero do artigo');return;}let artigoMontado=artigo;if(paragrafo)artigoMontado+=`,¬ß${paragrafo}¬∫`;if(inciso)artigoMontado+=`,${inciso}`;if(alinea)artigoMontado+=`,"${alinea}"`;if(concomitante)artigoMontado+=` c/c ${concomitante}`;artigoInput.value=artigoMontado;artigoInput.focus();verificarCamposPreenchidos();debouncedSugestoes(artigoInput.value.trim());});artigoInput.addEventListener('input',function(){const valorAtual=this.value;const valorTrim=valorAtual.trim();if(valorTrim&&valorTrim.length>0){const valorFormatado=aplicarFormatacaoAutomatica2(valorTrim);if(valorFormatado!==valorTrim){const posicaoCursor=this.selectionStart;this.value=valorFormatado;const novaPos=Math.min(posicaoCursor+(valorFormatado.length-valorTrim.length),valorFormatado.length);this.setSelectionRange(novaPos,novaPos);}}verificarCamposPreenchidos();debouncedSugestoes(valorTrim);});buscarBtn.addEventListener('click',realizarBusca);leiSelect.addEventListener('keydown',function(e){if(e.key==='Enter'&&this.value){artigoInput.focus();}});artigoInput.addEventListener('keydown',function(e){if(e.key==='Enter'&&!buscarBtn.disabled){realizarBusca();}});document.addEventListener('keydown',function(e){if(e.ctrlKey&&e.key==='l'){e.preventDefault();leiSelect.focus();}if(e.ctrlKey&&e.key==='a'){e.preventDefault();if(!artigoInput.disabled){artigoInput.focus();}}if(e.ctrlKey&&e.key==='Enter'){e.preventDefault();if(!buscarBtn.disabled){realizarBusca();}}if(e.key==='F1'){e.preventDefault();if(radioCondenacao.checked){radioExtincao.checked=true;radioExtincao.dispatchEvent(new Event('change'));}else{radioCondenacao.checked=true;radioCondenacao.dispatchEvent(new Event('change'));}}});}function aplicarFormatacaoAutomatica(valor){if(!valor||typeof valor!=='string'){return valor;}let formatado=valor.trim();formatado=formatado.replace(/\s+/g,' ');formatado=formatado.replace(/¬ß\s*(\d+)(?![¬∫¬∞])/g,'¬ß$1¬∫');formatado=formatado.replace(/(?<!\/)(cc|CC|C\/c|c\/C)(?!\/)/g,'c/c');formatado=formatado.replace(/\s*,\s*/g,',');formatado=formatado.replace(/(?<!["\'])([a-z])(?=\s*(?:,|$|\s))/gi,(match,letra)=>{if(letra.match(/["']/))return match;return `"${letra.toLowerCase()}"`;});return formatado;}function verificarCamposPreenchidos(){const leiSelecionada=leiSelect.value.trim();const artigoDigitado=artigoInput.value.trim();buscarBtn.disabled=!(leiSelecionada&&artigoDigitado);}function realizarBusca(){const leiSelecionada=leiSelect.value.trim();const artigoDigitado=artigoInput.value.trim();if(!leiSelecionada||!artigoDigitado){alert('Por favor,selecione uma lei e digite o artigo.');return;}esconderSugestoes();const resultado=buscarInelegibilidadePorLeiEArtigo(leiSelecionada,artigoDigitado);if(resultado){exibirResultado(resultado);}else{exibirNaoEncontrado(leiSelecionada,artigoDigitado);}}function buscarInelegibilidadePorLeiEArtigo(codigoLei,numeroArtigo){console.log('üîç INICIANDO BUSCA:',{codigoLei,numeroArtigo});if(numeroArtigo.trim().length<2){console.log('‚ùå Artigo muito curto:',numeroArtigo);return null;}const artigoProcessado=processarArtigoCompleto(numeroArtigo);console.log('üìù ARTIGO PROCESSADO:',artigoProcessado);let melhorResultado=null;let excecoesEncontradas=[];const candidatos=getItensPorLei(codigoLei);for(const item of candidatos){const leiCorresponde=verificarLeiCorresponde(item,codigoLei);if(!leiCorresponde){continue;}const artigoCorresponde=verificarArtigoCorresponde(item.norma,artigoProcessado);if(artigoCorresponde){console.log('‚úÖ ENCONTRADO!',item);const temExcecao=verificarExcecoesAplicaveis2(item,artigoProcessado);if(temExcecao){excecoesEncontradas.push({norma: item.norma,excecoes: item.excecoes,crime: item.crime,observacao: item.observacao});console.log('‚ö†Ô∏è EXCE√á√ÉO ENCONTRADA:',temExcecao);}melhorResultado={...item,artigoOriginal: numeroArtigo,artigoProcessado: artigoProcessado,inelegivel:!temExcecao,temExcecao: temExcecao,excecoes: filtrarExcecoesDoMesmoArtigo(item.excecoes||[],artigoProcessado),excecoesDetalhes: excecoesEncontradas};break;}}if(!melhorResultado){melhorResultado=buscarFlexivel(codigoLei,artigoProcessado);}return melhorResultado;}function buscarFlexivel(codigoLei,artigoProcessado){console.log('üîé INICIANDO BUSCA FLEX√çVEL...');const artigoPrincipal=artigoProcessado.artigo;if(artigoPrincipal.length<2){console.log('‚ùå Artigo muito curto para busca flex√≠vel:',artigoPrincipal);return null;}for(const item of tabelaInelegibilidade){if(!verificarLeiCorresponde(item,codigoLei)){continue;}const artigos=extrairArtigosDoNorma(item.norma);if(artigos.includes(artigoPrincipal)){console.log('üî∏ ENCONTRADO COM BUSCA FLEX√çVEL:',item.norma,'-Artigos:',artigos);const temExcecao=verificarExcecoesAplicaveis2(item,artigoProcessado);return{...item,artigoProcessado: artigoProcessado,inelegivel:!temExcecao,temExcecao: temExcecao,excecoes: filtrarExcecoesDoMesmoArtigo(item.excecoes||[],artigoProcessado),buscaFlexivel: true};}}return null;}function verificarExcecoesAplicaveis(item,artigoProcessado){return verificarExcecoesAplicaveis2(item,artigoProcessado);}function processarArtigoCompleto(artigo){const artigoLimpo=artigo.trim();const resultado={original: artigoLimpo,artigo: '',paragrafo: '',inciso: '',alinea: '',concomitante: [],formatado: ''};const partesConcomitantes=artigoLimpo.split(/\s+c\/c\s+/i);if(partesConcomitantes.length>1){const artPrincipal=processarParteArtigo(partesConcomitantes[0]);Object.assign(resultado,artPrincipal);for(let i=1;i<partesConcomitantes.length;i++){resultado.concomitante.push(processarParteArtigo(partesConcomitantes[i]));}resultado.formatado=formatarArtigoCompleto(resultado);}else{const artProcessado=processarParteArtigo(artigoLimpo);Object.assign(resultado,artProcessado);resultado.formatado=formatarArtigoCompleto(resultado);}return resultado;}function processarParteArtigo(parte){const resultado={artigo: '',paragrafo: '',inciso: '',alinea: ''};if(!parte||typeof parte!=='string'){return resultado;}let texto=parte.trim().replace(/\s+/g,' ');if(!texto){return resultado;}const matchArtigo=texto.match(/^(\d+)/);if(matchArtigo){resultado.artigo=matchArtigo[1];texto=texto.substring(matchArtigo[0].length).trim();}const matchParagrafo=texto.match(/[,\s]*¬ß\s*(\d+)[¬∫¬∞]?/i);if(matchParagrafo){resultado.paragrafo=matchParagrafo[1];texto=texto.replace(matchParagrafo[0],'').trim();}const matchInciso=texto.match(/[,\s]*(I{1,3}|IV|V|VI{0,3}|IX|X{1,3})/i);if(matchInciso){resultado.inciso=matchInciso[1].toUpperCase();texto=texto.replace(matchInciso[0],'').trim();}const matchAlinea=texto.match(/[,\s]*['"]?([a-z])['"]?/i);if(matchAlinea){resultado.alinea=matchAlinea[1].toLowerCase();}return resultado;}function formatarArtigoCompleto(artigo){let formatado=artigo.artigo;if(artigo.paragrafo){formatado+=`,¬ß${artigo.paragrafo}¬∫`;}if(artigo.inciso){formatado+=`,${artigo.inciso}`;}if(artigo.alinea){formatado+=`,"${artigo.alinea}"`;}if(artigo.concomitante&&artigo.concomitante.length>0){const concomitantes=artigo.concomitante.map(c=>formatarParteArtigo(c)).join(' c/c ');formatado+=` c/c ${concomitantes}`;}return formatado;}function formatarParteArtigo(parte){let formatado=parte.artigo;if(parte.paragrafo){formatado+=`,¬ß${parte.paragrafo}¬∫`;}if(parte.inciso){formatado+=`,${parte.inciso}`;}if(parte.alinea){formatado+=`,"${parte.alinea}"`;}return formatado;}function extrairArtigosDoNorma(normaString){if(!normaString)return [];const norma=normaString.toLowerCase();const artigos=[];const matchArts=norma.match(/art\.?s?\.?\s+([\d\-\s,;"'a-z¬ß¬∫¬∞√†√°√§√¢√£√®√©√´√™√¨√≠√Ø√Æ√≤√≥√∂√¥√π√∫√º√ª√ß√±.e-]+)/gi);if(matchArts){for(const match of matchArts){const semaRtigo=match.replace(/^art\.?s?\.?\s+/i,'');const numeroMatches=semaRtigo.match(/\b(\d+)(?:-[a-z])?\b/gi);if(numeroMatches){for(const num of numeroMatches){artigos.push(num.match(/\d+/)[0]);}}}}return [...new Set(artigos)];}function verificarArtigoCorresponde(artigoTabela,artigoProcessado){if(!artigoTabela||!artigoProcessado||!artigoProcessado.artigo){return false;}const artigoPrincipal=artigoProcessado.artigo.toLowerCase().trim();if(!artigoPrincipal.trim()){return false;}const artigos=extrairArtigosDoNorma(artigoTabela);console.log(`Artigos extra√≠dos de "${artigoTabela}": ${artigos.join(',')}`);console.log(`Procurando por: "${artigoPrincipal}"`);return artigos.includes(artigoPrincipal);}function verificarLeiCorresponde(item,codigoLei){const codigoNormalizado=item.codigo.toLowerCase();switch(codigoLei){case 'CP': return codigoNormalizado==='cp';case 'CPM': return codigoNormalizado==='cpm';case 'CLT': return codigoNormalizado==='clt';case 'LEI_FALIMENTAR_ANTIGA': return codigoNormalizado==='lei_falimentar';case 'DL_201': return codigoNormalizado==='dl_201';case 'LC_105': return codigoNormalizado==='lc_105';case 'LEI_1521': return codigoNormalizado==='lei_1521';case 'LEI_2889': return codigoNormalizado==='lei_2889';case 'LEI_4591': return codigoNormalizado==='lei_4591';case 'LEI_4595': return codigoNormalizado==='lei_4595';case 'LEI_4728': return codigoNormalizado==='lei_4728';case 'CODIGO_ELEITORAL': return codigoNormalizado==='codigo_eleitoral';case 'LEI_4898': return codigoNormalizado==='lei_4898';case 'LEI_6091': return codigoNormalizado==='lei_6091';case 'LEI_6368': return codigoNormalizado==='lei_6368';case 'LEI_6385': return codigoNormalizado==='lei_6385';case 'LEI_6766': return codigoNormalizado==='lei_6766';case 'LEI_6996': return codigoNormalizado==='lei_6996';case 'LEI_7492': return codigoNormalizado==='lei_7492';case 'LEI_7716': return codigoNormalizado==='lei_7716';case 'ECA': return codigoNormalizado==='eca';case 'LEI_8137': return codigoNormalizado==='lei_8137';case 'LEI_8176': return codigoNormalizado==='lei_8176';case 'LEI_8666': return codigoNormalizado==='lei_8666';case 'LEI_9455': return codigoNormalizado==='lei_9455';case 'LEI_9504': return codigoNormalizado==='lei_9504';case 'LEI_9605': return codigoNormalizado==='lei_9605';case 'LEI_9613': return codigoNormalizado==='lei_9613';case 'LEI_10826': return codigoNormalizado==='lei_10826';case 'LEI_11101': return codigoNormalizado==='lei_11101';case 'LEI_11343': return codigoNormalizado==='lei_11343';case 'LEI_12850': return codigoNormalizado==='lei_12850';case 'LEI_13260': return codigoNormalizado==='lei_13260';default: return false;}}function exibirResultado(resultado){const leiInfo=leisDisponiveis.find(l=>l.value===resultado.codigo);const nomeLei=leiInfo ? leiInfo.descricao : resultado.codigo;const statusClass=resultado.inelegivel ? 'inelegivel' : 'elegivel';const statusTexto=resultado.inelegivel ? 'INELEG√çVEL' : 'ELEG√çVEL';const statusIcon=resultado.inelegivel ? '‚ùå' : '‚úÖ';const artigoExibicao=resultado.artigoProcessado ? resultado.artigoProcessado.formatado : resultado.artigoConsultado;let explicacao='';let alertaExcecao='';if(resultado.inelegivel){explicacao=`O artigo ${artigoExibicao}do ${nomeLei}est√° previsto na coluna "NORMA/INCID√äNCIA" e gera ineligibilidade.`;if(resultado.excecoes&&resultado.excecoes.length>0){alertaExcecao=`<div class="alerta-excecao"><span class="alerta-icon">‚ö†Ô∏è</span><div class="alerta-conteudo"><strong>ATEN√á√ÉO-EXCE√á√ïES EXISTENTES:</strong><p class="mt-2">Este artigo possui as seguintes exce√ß√µes que podem N√ÉO gerar ineligibilidade caso o condenado se enquadre nelas:</p><ul class="mt-2 pl-5">${resultado.excecoes.map(exc=>`<li>${exc}</li>`).join('')}</ul><p class="mt-2 text-sm"><strong>Importante:</strong>Se o caso se enquadrar em uma exce√ß√£o,o resultado seria<strong>ELEG√çVEL</strong>.</p></div></div>`;}}else{explicacao=`O artigo ${artigoExibicao}do ${nomeLei}est√° previsto na coluna "NORMA/INCID√äNCIA",mas uma exce√ß√£o espec√≠fica se aplica a este caso,tornando-o eleg√≠vel.`;if(resultado.temExcecao){alertaExcecao=`<div class="alerta-excecao"><span class="alerta-icon">‚ö†Ô∏è</span><div class="alerta-conteudo"><strong>ATEN√á√ÉO-EXCE√á√ÉO APLIC√ÅVEL:</strong><p class="mt-2">Este artigo possui uma exce√ß√£o que se aplica a este caso espec√≠fico,tornando-o eleg√≠vel:</p><ul class="mt-2 pl-5"><li>${resultado.temExcecao}</li></ul><p class="mt-2 text-sm"><strong>Importante:</strong>Como o caso se enquadra nesta exce√ß√£o,o resultado √©<strong>ELEG√çVEL</strong>.</p></div></div>`;}}let detalhesArtigo='';if(resultado.artigoProcessado&&(resultado.artigoProcessado.paragrafo||resultado.artigoProcessado.inciso||resultado.artigoProcessado.alinea||resultado.artigoProcessado.concomitante.length>0)){detalhesArtigo='<div class="detalhes-artigo">';detalhesArtigo+='<h4>üìã Detalhes do Artigo Consultado:</h4>';detalhesArtigo+='<div class="artigo-componentes">';if(resultado.artigoProcessado.paragrafo){detalhesArtigo+=`<span class="componente">Par√°grafo: ¬ß${resultado.artigoProcessado.paragrafo}¬∫</span>`;}if(resultado.artigoProcessado.inciso){detalhesArtigo+=`<span class="componente">Inciso: ${resultado.artigoProcessado.inciso}</span>`;}if(resultado.artigoProcessado.alinea){detalhesArtigo+=`<span class="componente">Al√≠nea: "${resultado.artigoProcessado.alinea}"</span>`;}if(resultado.artigoProcessado.concomitante.length>0){const concomitantes=resultado.artigoProcessado.concomitante .map(c=>formatarParteArtigo(c)).join(',');detalhesArtigo+=`<span class="componente concomitante">Concomitante: ${concomitantes}</span>`;}detalhesArtigo+='</div></div>';}const tipoComunicacao=obterTipoComunicacao();const aseInfo=__genAsePad(tipoComunicacao,resultado.inelegivel);abrirModal(statusClass,(resultado.inelegivel ? '‚ùå' : '‚úÖ'),statusTexto,`<div class="consulta-header"><p class="text-center m-0 text-[0.95rem] text-gray-600"><strong>Consulta:</strong>${nomeLei},Artigo ${artigoExibicao}</p></div><div class="modal-resultado-card"><div class="modal-resultado-header"><span class="modal-resultado-icon">${statusIcon}</span><span class="modal-resultado-status ${statusClass}">${statusTexto}</span></div><div class="modal-resultado-detalhes"><p>üßæ<strong>Crime:</strong>${resultado.crime}</p><p>üìò<strong>Norma/Incid√™ncia:</strong>Art. ${artigoExibicao}</p>${aseInfo}${alertaExcecao}${detalhesArtigo}${resultado.observacao ? `<p>üìù<strong>Observa√ß√£o:</strong>${resultado.observacao}</p>` : ''}</div></div>`);}function exibirNaoEncontrado(codigoLei,artigo){const leiInfo=leisDisponiveis.find(l=>l.value===codigoLei);const nomeLei=leiInfo ? leiInfo.descricao : codigoLei;const tipoComunicacao=obterTipoComunicacao();const interpretacao=tipoComunicacao==='condenacao' ? 'Como o artigo n√£o est√° listado na coluna "NORMA/INCID√äNCIA",a condena√ß√£o por este artigo N√ÉO gera inelegibilidade conforme ASE 337,raz√£o 7.' : 'Como o artigo n√£o est√° listado na coluna "NORMA/INCID√äNCIA",a extin√ß√£o relacionada a este artigo N√ÉO gera inelegibilidade e n√£o requer ASE 370 ou ASE 540.';abrirModal('nao-encontrado','‚ÑπÔ∏è','N√ÉO ENCONTRADO',`<div class="modal-resultado-card"><div class="modal-resultado-header"><span class="modal-resultado-icon">‚ÑπÔ∏è</span><span class="modal-resultado-status nao-encontrado">N√ÉO ENCONTRADO</span></div><div class="modal-resultado-detalhes"><p><strong>Consulta:</strong>${nomeLei},Artigo ${artigo}</p><p><strong>Tipo de Comunica√ß√£o:</strong>${tipoComunicacao==='condenacao' ? 'Condena√ß√£o' : 'Extin√ß√£o'}</p><p><strong>Resultado:</strong>O artigo consultado n√£o foi encontrado na tabela de inelegibilidade.</p><p><strong>Interpreta√ß√£o:</strong>${interpretacao}</p></div></div>`);}function mostrarSugestoes(termo){const leiSelecionada=leiSelect.value;if(!leiSelecionada)return;const sugestoes=obterSugestoesPorLei(leiSelecionada,termo);if(sugestoes.length>0){const sugestoesHtml=sugestoes.map(sugestao=>`<div class="sugestao-item" onclick="selecionarSugestao('${sugestao}')"><div class="flex items-center gap-3"><div class="w-2 h-2 bg-primary-500 rounded-full"></div><span class="font-medium">${sugestao}</span></div></div>`).join('');sugestoesDiv.innerHTML=sugestoesHtml;sugestoesDiv.classList.add('show');}else{esconderSugestoes();}}function obterSugestoesPorLei(codigoLei,termo){const sugestoes=new Set();const termoNormalizado=termo.toLowerCase().trim();if(!termoNormalizado||termoNormalizado.length===0){return [];}tabelaInelegibilidade.forEach(item=>{if(verificarLeiCorresponde(item,codigoLei)){const artigos=extrairArtigos(item.norma);artigos.forEach(artigo=>{const artigoLower=artigo.toLowerCase();if(artigoLower.includes(termoNormalizado)||artigoLower.startsWith(termoNormalizado)||termoNormalizado.startsWith(artigo.substring(0,3))){sugestoes.add(artigo);}});}});return Array.from(sugestoes).sort((a,b)=>{const aStarts=a.toLowerCase().startsWith(termoNormalizado)? 0 : 1;const bStarts=b.toLowerCase().startsWith(termoNormalizado)? 0 : 1;return aStarts-bStarts||a.length-b.length;}).slice(0,10);}function selecionarSugestao(artigo){artigoInput.value=artigo;esconderSugestoes();verificarCamposPreenchidos();artigoInput.focus();}function esconderSugestoes(){sugestoesDiv.classList.remove('show');setTimeout(()=>{sugestoesDiv.innerHTML='';},200);}function limparBusca(){leiSelect.value='';artigoInput.value='';artigoInput.disabled=true;buscarBtn.disabled=true;resultadoDiv.style.display='none';resultadoDiv.classList.remove('show');esconderSugestoes();leiSelect.focus();}function copiarResultado(){const modalBody=document.getElementById('modalBody');if(modalBody){const resultado=modalBody.textContent;navigator.clipboard.writeText(resultado).then(()=>{mostrarToast('Resultado copiado para a √°rea de transfer√™ncia');}).catch(()=>{mostrarToast('Erro ao copiar resultado',true);});}}let conteudoModalAtual='';let __modalTrapHandler=null;let __lastFocusedElement=null;function abrirModal(tipoResultado,icone,status,conteudo){const modal=document.getElementById('modalResultado');const modalContent=modal.querySelector('.modal-content');const modalBody=document.getElementById('modalBody');conteudoModalAtual=conteudo;modalContent.className=`modal-content ${tipoResultado}`;modalBody.innerHTML=`<div class="result-card ${tipoResultado}">${conteudo}</div>`;try{let html=modalBody.innerHTML;html=html.replace(/\?\?\s*<strong>Crime:/g,'üßæ<strong>Crime:');html=html.replace(/\?\?\s*<strong>Norma\/Incid[ÔøΩ√™]ncia:/g,'üìò<strong>Norma/Incid√™ncia:');html=html.replace(/\?\?\s*<strong>Observa[ÔøΩÔøΩ]o:/g,'üìù<strong>Observa√ß√£o:');html=html.replace(/\?\?\s*Data de Ocorr[ÔøΩ√™]ncia para ASE 370: decis[√£ÔøΩ]o judicial que declarou a extin[√ßÔøΩÔøΩ]o/g,'‚ö†Ô∏è Data de Ocorr√™ncia para ASE 370: decis√£o judicial que declarou a extin√ß√£o');modalBody.innerHTML=html;}catch(e){}const iconEl=modalBody.querySelector('.modal-resultado-icon');if(iconEl){iconEl.textContent=icone;}modal.classList.remove('hidden');modal.classList.add('show');setTimeout(()=>{modalContent.style.opacity='1';modalContent.style.transform='scale(1)';},10);document.body.style.overflow='hidden';__lastFocusedElement=document.activeElement;modalContent.setAttribute('tabindex','-1');modalContent.focus();const focusableSelectors='a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])';const getFocusable=()=>Array.from(modalContent.querySelectorAll(focusableSelectors)).filter(el=>!el.hasAttribute('disabled'));__modalTrapHandler=(e)=>{if(e.key!=='Tab')return;const els=getFocusable();if(els.length===0)return;const first=els[0];const last=els[els.length-1];if(e.shiftKey){if(document.activeElement===first){e.preventDefault();last.focus();}}else{if(document.activeElement===last){e.preventDefault();first.focus();}}};modalContent.addEventListener('keydown',__modalTrapHandler);}function mostrarToast(msg,type='info'){const toast=document.createElement('div');toast.className=`toast ${type}`;const icons={success: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',error: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',warning: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg>',info: '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>'};toast.innerHTML=`<div class="toast-content"><div class="toast-icon">${icons[type]||icons.info}</div><div class="toast-message">${msg}</div></div>`;document.body.appendChild(toast);requestAnimationFrame(()=>{toast.classList.add('show');});setTimeout(()=>{toast.classList.remove('show');setTimeout(()=>{if(toast.parentNode){toast.remove();}},400);},4000);toast.addEventListener('click',()=>{toast.classList.remove('show');setTimeout(()=>{if(toast.parentNode){toast.remove();}},400);});}function fecharModal(){const modal=document.getElementById('modalResultado');const modalContent=modal.querySelector('.modal-content');modalContent.style.opacity='0';modalContent.style.transform='scale(0.95)';setTimeout(()=>{modal.classList.add('hidden');modal.classList.remove('show');document.body.style.overflow='auto';if(__modalTrapHandler&&modalContent){modalContent.removeEventListener('keydown',__modalTrapHandler);__modalTrapHandler=null;}if(__lastFocusedElement&&typeof __lastFocusedElement.focus==='function'){__lastFocusedElement.focus();}},300);}function novaConsulta(){fecharModal();limparBusca();}document.addEventListener('keydown',function(event){if(event.key==='Escape'){const modal=document.getElementById('modalResultado');if(modal.classList.contains('show')){fecharModal();}}});function aplicarFormatacaoAutomatica2(valor){if(!valor||typeof valor!=='string')return valor;let formatado=valor.trim();formatado=formatado.replace(/\s+/g,' ');formatado=formatado .replace(/(?:¬ß|\u00A7|\uFFFD)\s*(\d+)(?!\s*(?:¬∫|\u00BA|\uFFFD))/g,'¬ß$1¬∫').replace(/\bpar[a√°]grafo\s*(\d+)/i,'¬ß$1¬∫');formatado=formatado.replace(/(?<!\/)(cc|CC|C\/c|c\/C)(?!\/)/g,'c/c');formatado=formatado.replace(/\s*,\s*/g,',');formatado=formatado.replace(/(?<!["\'])([a-z])(?=\s*(?:,|$|\s))/gi,(match,letra)=>{if(/["']/.test(letra))return match;return `"${letra.toLowerCase()}"`;});return formatado;}function verificarExcecoesAplicaveis2(item,artigoProcessado){if(!item.excecoes||item.excecoes.length===0){return null;}const artigoPrincipal=(artigoProcessado.artigo||'').toLowerCase();const paragrafo=artigoProcessado.paragrafo ? String(artigoProcessado.paragrafo).toLowerCase(): null;const inciso=artigoProcessado.inciso ? String(artigoProcessado.inciso).toLowerCase(): null;const alinea=artigoProcessado.alinea ? String(artigoProcessado.alinea).toLowerCase(): null;const normalize=(s)=>{try{return String(s).normalize('NFD').replace(/\p{Diacritic}/gu,'');}catch{return String(s);}};for(const excecao of item.excecoes){const excLower=String(excecao||'').toLowerCase();const excNorm=normalize(excLower);if(paragrafo||inciso||alinea){let tem=false;if(paragrafo&&!tem){if(new RegExp(`(¬ß|\\u00a7|\\uFFFD)\\s*${paragrafo}`).test(excLower)||new RegExp(`paragrafo\\s*${paragrafo}`).test(excNorm)){tem=true;}}if(inciso&&!tem){if(new RegExp(`(^|[\\s,])${inciso}(?=$|[\\s,])`).test(excLower)||new RegExp(`inciso\\s*${inciso}`).test(excNorm)){tem=true;}}if(alinea&&!tem){if(new RegExp(`"${alinea}"`).test(excLower)||new RegExp(`alinea\\s*${alinea}`).test(excNorm)){tem=true;}}if(tem){return excecao;}}else{const temPar=/(¬ß|\\u00a7|\\uFFFD)\\s*\\d|paragrafo/i.test(excNorm);const temInc=/,\\s*[ivx]+|inciso/i.test(excNorm);const temAli=/"\\w"|alinea/i.test(excNorm);if(temPar||temInc||temAli)continue;if(excLower.includes(`,${artigoPrincipal},`)||excLower.includes(`art. ${artigoPrincipal},caput`)||excLower.includes(`art. ${artigoPrincipal}caput`)||excLower===`art. ${artigoPrincipal}`||excLower===`arts. ${artigoPrincipal}`){return excecao;}}}return null;}function filtrarExcecoesDoMesmoArtigo(excecoes,artigoProcessado){if(!Array.isArray(excecoes))return [];const num=(artigoProcessado&&artigoProcessado.artigo)? String(artigoProcessado.artigo): '';if(!num)return [];const rx=new RegExp(String.raw`\bart\.?s?\.?\s*${num}(?!-)`,'i');const norm=(s)=>{try{return String(s||'').normalize('NFD').replace(/\p{Diacritic}/gu,'');}catch{return String(s||'')}};return excecoes.filter((ex)=>rx.test(norm(ex)));}let __indicePorLei=null;function construirIndicePorLei(){__indicePorLei={};try{leisDisponiveis.forEach(lei=>{const codigoLei=lei.value;const itens=[];tabelaInelegibilidade.forEach(it=>{if(verificarLeiCorresponde(it,codigoLei)){try{it._artigos=extrairArtigosDoNorma(it.norma);}catch{it._artigos=[];}itens.push(it);}});__indicePorLei[codigoLei]=itens;});}catch{}}function getItensPorLei(codigoLei){if(!__indicePorLei)construirIndicePorLei();return __indicePorLei[codigoLei]||[];}function __genAsePad(tipo,inelegivel){if(tipo==='condenacao'){const motivo=inelegivel ? 'Motivo 7' : 'Motivo 2';const cls=inelegivel ? 'ase-337-warning' : 'ase-337-success';return `<p class="ase-card ${cls}"><strong>ASE 337-${motivo}:</strong>Condena√ß√£o criminal<br><strong>Data de Ocorr√™ncia:</strong>Tr√¢nsito em julgado da senten√ßa condenat√≥ria</p>`;}else{return `<p class="ase-card ase-370-info"><strong>ASE 370-Extin√ß√£o de Punibilidade</strong><br><strong>Data de Ocorr√™ncia:</strong>Decis√£o judicial que declarou a extin√ß√£o ${inelegivel ? '<br><em>Observa√ß√£o:</em>Se resultar em inelegibilidade,gerar automaticamente o ASE 540(Cancelamento de Inelegibilidade).' : ''}</p>`;}}